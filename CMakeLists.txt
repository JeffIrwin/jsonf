# CMakeLists.txt generated by fpm
# Project hash: 3A6C14B2C2D4E5F4

cmake_minimum_required(VERSION 3.12)
project(jsonf VERSION 0.3.0 LANGUAGES Fortran)

# Library
add_library(jsonf_lib
    src/jsonf.F90
    src/utils.F90
    src/sort.F90
    src/blarg.F90
)
set_source_files_properties(
    src/jsonf.F90
    src/utils.F90
    src/sort.F90
    src/blarg.F90
    PROPERTIES Fortran_FORMAT FREE
)
set_target_properties(jsonf_lib PROPERTIES
    Fortran_MODULE_DIRECTORY "${CMAKE_BINARY_DIR}/mod"
    POSITION_INDEPENDENT_CODE ON
)
target_include_directories(jsonf_lib PUBLIC
    $<BUILD_INTERFACE:${CMAKE_BINARY_DIR}/mod>
    $<INSTALL_INTERFACE:include>
)
target_compile_options(jsonf_lib PUBLIC
    $<$<COMPILE_LANGUAGE:Fortran>:-cpp>
)


# Executables
add_executable(jsonf
    app/main.F90
    app/args.F90
)
set_source_files_properties(
    app/main.F90
    app/args.F90
    PROPERTIES Fortran_FORMAT FREE
)
target_link_libraries(jsonf PRIVATE
    jsonf_lib
)
target_compile_options(jsonf PRIVATE
    $<$<COMPILE_LANGUAGE:Fortran>:-cpp>
)

# Tests
enable_testing()

add_executable(test_exe
    test/test.F90
)
set_target_properties(test_exe PROPERTIES
    OUTPUT_NAME "test"
)
set_source_files_properties(
    test/test.F90
    PROPERTIES Fortran_FORMAT FREE
)
target_link_libraries(test_exe PRIVATE
    jsonf_lib
)
target_compile_options(test_exe PRIVATE
    $<$<COMPILE_LANGUAGE:Fortran>:-cpp>
)
add_test(NAME test COMMAND $<TARGET_FILE:test_exe> WORKING_DIRECTORY ${CMAKE_SOURCE_DIR})

